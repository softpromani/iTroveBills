import{T as I,p as b,o as f,c as m,b as o,a as tt,w as et,q as lt,F as C,x as H,t as r,C as c,e as at,n as ot,d as st,f as N,y as nt,D as y}from"./app-bbd8229e.js";import{_ as ut}from"./_plugin-vue_export-helper-c27b6911.js";const it={key:0},ct={class:"-mt-4 rounded-lg shadow table-responsive"},rt={class:"table table-bordered"},dt=["value","onInput","onKeydown"],pt={class:"position-relative"},vt=["value","onInput","onFocus","onBlur","onKeydown"],ft={key:0,class:"dropdown-menu show position-absolute w-100",style:{top:"100%","z-index":"1000","max-height":"200px","overflow-y":"auto"}},mt=["onMousedown"],ht=["value","onInput","onKeydown"],bt=["value","onInput","onKeydown"],yt=["value","onInput","onKeydown"],gt=["value","onInput","onKeydown"],_t={class:"text-end"},Ft=["value","onInput","onKeydown"],$t=["value","onInput","onKeydown"],Kt={class:"text-end"},Tt=["onClick"],Ct=["onClick"],Nt={class:"table-info"},Vt={class:"font-bold text-end"},kt={class:"font-bold text-end"},Et={class:"font-bold text-end"},St={class:"font-bold text-end"},At={__name:"Editable",setup(Bt){const O=I({}),n=b([["","",0,"",0,0,0,0]]),V=b([]),F=b(!0),i=b({}),d=b({}),$=b(null),u=b({}),h=(t,l)=>{l&&(u.value[t]=l)},z=()=>{F.value=!F.value},p=(t,l,s)=>{t.shiftKey?(t.preventDefault(),W(l,s)):(t.preventDefault(),M(l,s))},M=(t,l)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(l<s.length-1){const e=`${s[l+1]}-${t}`;y(()=>{u.value[e]&&u.value[e].focus()})}else if(t<n.value.length-1){const e=`${s[0]}-${t+1}`;y(()=>{u.value[e]&&u.value[e].focus()})}else S(t),y(()=>{const e=t+1,a=`${s[0]}-${e}`;u.value[a]&&u.value[a].focus()})},W=(t,l)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(l>0){const e=`${s[l-1]}-${t}`;y(()=>{u.value[e]&&u.value[e].focus()})}else if(t>0){const e=`${s[s.length-1]}-${t-1}`;y(()=>{u.value[e]&&u.value[e].focus()})}},v=(t,l,s)=>{let e=s.target.value;if([2,4,5,6,7].includes(l)){const a=parseFloat(e);e=isNaN(a)?0:a}n.value[t][l]=e,[2,5].includes(l)&&Z(t)},L=async(t,l)=>{const s=l.target.value;if(v(t,1,l),$.value&&clearTimeout($.value),!s.trim()){d.value[t]=!1,i.value[t]=[];return}$.value=setTimeout(async()=>{try{const e=await nt.get("/hsn/search",{params:{q:s}});i.value[t]=e.data,d.value[t]=!0}catch(e){console.error("Error searching HSN codes:",e),i.value[t]=[]}},300)},j=t=>{setTimeout(()=>{d.value[t]=!1},200)},Q=t=>{d.value[t]=!1},U=t=>{i.value[t]&&i.value[t].length>0&&k(t,i.value[t][0])},k=(t,l)=>{n.value[t][1]=l.code,d.value[t]=!1,i.value[t]=[],y(()=>{const s=`quantity-${t}`;u.value[s]&&u.value[s].focus()})},J=(t,l)=>{v(t,6,l),E(t)},X=(t,l)=>{v(t,7,l),Y(t)},E=t=>{const l=parseFloat(n.value[t][6])||0,e=(parseFloat(g(t))||0)*l/100;n.value[t][7]=parseFloat(e.toFixed(2))},Y=t=>{const l=parseFloat(n.value[t][7])||0,s=parseFloat(g(t))||0;if(s>0){const e=l/s*100;n.value[t][6]=parseFloat(e.toFixed(2))}},Z=t=>{(parseFloat(n.value[t][6])||0)>0&&E(t)},S=t=>{const l=["","",0,"",0,0,0,0];n.value.splice(t+1,0,l),y(()=>{})},x=t=>{n.value.length>1&&(n.value.splice(t,1),Object.keys(u.value).forEach(l=>{l.includes(`-${t}`)&&delete u.value[l]}),delete i.value[t],delete d.value[t])},g=t=>{const l=parseFloat(n.value[t][2])||0,s=parseFloat(n.value[t][5])||0;return(l*s).toFixed(2)},A=t=>{const l=parseFloat(g(t))||0,s=parseFloat(n.value[t][7])||0;return(l+s).toFixed(2)},B=()=>n.value.reduce((t,l)=>t+(parseFloat(l[4])||0),0).toFixed(2),D=()=>n.value.reduce((t,l,s)=>t+parseFloat(g(s)),0).toFixed(2),G=()=>n.value.reduce((t,l)=>t+(parseFloat(l[7])||0),0).toFixed(2),P=()=>n.value.reduce((t,l,s)=>t+parseFloat(A(s)),0).toFixed(2),w=()=>{var _,K,q,R;const t=((_=document.getElementById("invoice_no"))==null?void 0:_.value)||"",l=((K=document.getElementById("customer"))==null?void 0:K.value)||"",s=((q=document.getElementById("company"))==null?void 0:q.value)||"",e=((R=document.getElementById("vehical_no"))==null?void 0:R.value)||"";if(!t||!l||!s||!e){alert("Please fill in all required fields (Invoice No, Customer, Company, Vehicle No)");return}if(!n.value.some(T=>T[0].trim()!==""||T[1].trim()!==""||parseFloat(T[2])>0)){alert("Please add at least one item to the invoice");return}V.value[0]={invoice:t,customer:l,company:s,vehical_no:e,totalWeight:B(),totalTaxableValue:D(),totalGstAmount:G(),grandTotal:P()},O.post(route("gst.customer.store.bill",{invoicedata:n.value,invoicedetails:V.value}),{preserveScroll:!0})};return(t,l)=>(f(),m(C,null,[o("div",{class:"mt-5 bg-purple-700 rounded-md position-relative"},[l[1]||(l[1]=o("h2",{class:"font-medium text-center text-white font-weight-bolder"}," INVOICE ",-1)),o("span",{class:"text-white cursor-pointer top-2 right-2 position-absolute",onClick:z},[...l[0]||(l[0]=[o("i",{class:"fa-solid fa-bullseye"},null,-1)])])]),tt(lt,{name:"slide-fade"},{default:et(()=>[F.value?(f(),m("div",it,[o("div",ct,[o("table",rt,[l[8]||(l[8]=o("thead",{class:"table-dark"},[o("tr",null,[o("th",null,"S.NO."),o("th",null,"Description of Product"),o("th",null,"HSN Code"),o("th",null,"Quantity"),o("th",null,"Unit"),o("th",null,"Weight"),o("th",null,"Rate"),o("th",null,"Taxable Value"),o("th",null,"GST %"),o("th",null,"GST Amount"),o("th",null,"Subtotal"),o("th",null,"Action")])],-1)),o("tbody",null,[(f(!0),m(C,null,H(n.value,(s,e)=>(f(),m("tr",{key:`row-${e}`},[o("td",null,r(e+1),1),o("td",null,[o("input",{type:"text",value:s[0],onInput:a=>v(e,0,a),onKeydown:c(a=>p(a,e,0),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter description"},null,40,dt)]),o("td",pt,[o("input",{type:"text",value:s[1],onInput:a=>L(e,a),onFocus:a=>d.value[e]=!0,onBlur:a=>j(e),onKeydown:[c(a=>p(a,e,1),["tab"]),c(a=>U(e),["enter"]),c(a=>Q(e),["escape"])],class:"form-control border-0 p-1",placeholder:"Enter HSN Code",autocomplete:"off",ref_for:!0,ref:a=>h(`hsn-${e}`,a)},null,40,vt),d.value[e]&&i.value[e]&&i.value[e].length>0?(f(),m("div",ft,[(f(!0),m(C,null,H(i.value[e],(a,_)=>(f(),m("div",{key:a.code,onMousedown:at(K=>k(e,a),["prevent"]),class:ot(["dropdown-item cursor-pointer hover-item",{active:_===0}]),style:{"font-size":"12px",padding:"8px 12px"}},[o("strong",null,r(a.code),1),st(" - "+r(a.description),1)],42,mt))),128))])):N("",!0)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[2],onInput:a=>v(e,2,a),onKeydown:c(a=>p(a,e,2),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`quantity-${e}`,a)},null,40,ht)]),o("td",null,[o("input",{type:"text",value:s[3],onInput:a=>v(e,3,a),onKeydown:c(a=>p(a,e,3),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter unit",ref_for:!0,ref:a=>h(`unit-${e}`,a)},null,40,bt)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[4],onInput:a=>v(e,4,a),onKeydown:c(a=>p(a,e,4),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`weight-${e}`,a)},null,40,yt)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[5],onInput:a=>v(e,5,a),onKeydown:c(a=>p(a,e,5),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`rate-${e}`,a)},null,40,gt)]),o("td",_t,r(g(e)),1),o("td",null,[o("input",{type:"number",step:"0.01",min:"0",max:"100",value:s[6],onInput:a=>J(e,a),onKeydown:c(a=>p(a,e,6),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`gst-percentage-${e}`,a)},null,40,Ft)]),o("td",null,[o("input",{type:"number",step:"0.01",min:"0",value:s[7],onInput:a=>X(e,a),onKeydown:c(a=>p(a,e,7),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`gst-amount-${e}`,a)},null,40,$t)]),o("td",Kt,r(A(e)),1),o("td",null,[o("span",{class:"cursor-pointer badge rounded-pill text-bg-primary me-2",onClick:a=>S(e)},[...l[2]||(l[2]=[o("i",{class:"fa fa-plus","aria-hidden":"true"},null,-1)])],8,Tt),n.value.length>1?(f(),m("span",{key:0,class:"cursor-pointer badge rounded-pill text-bg-danger",onClick:a=>x(e)},[...l[3]||(l[3]=[o("i",{class:"fa fa-minus","aria-hidden":"true"},null,-1)])],8,Ct)):N("",!0)])]))),128)),o("tr",Nt,[l[4]||(l[4]=o("td",{colspan:"5",class:"text-end font-bold"},"TOTALS:",-1)),o("td",Vt,r(B()),1),l[5]||(l[5]=o("td",null,null,-1)),o("td",kt,r(D()),1),l[6]||(l[6]=o("td",null,null,-1)),o("td",Et,r(G()),1),o("td",St,r(P()),1),l[7]||(l[7]=o("td",null,null,-1))])])])]),o("button",{class:"text-white btn btn-info text-bold mt-3",onClick:w}," Submit ")])):N("",!0)]),_:1})],64))}},Pt=ut(At,[["__scopeId","data-v-bee23b5a"]]);export{Pt as default};
