import{T as at,p as g,s as ot,o as f,c as h,b as o,a as st,w as nt,q as ut,F as N,x as z,t as r,C as c,e as it,n as ct,d as rt,f as V,y as dt,D as b}from"./app-bbd8229e.js";import{_ as pt}from"./_plugin-vue_export-helper-c27b6911.js";const vt={key:0},ft={class:"-mt-4 rounded-lg shadow table-responsive"},ht={class:"table table-bordered"},mt=["value","onInput","onKeydown"],gt={class:"position-relative"},bt=["value","onInput","onFocus","onBlur","onKeydown"],yt={key:0,class:"dropdown-menu show position-absolute w-100",style:{top:"100%","z-index":"1000","max-height":"200px","overflow-y":"auto"}},_t=["onMousedown"],Ft=["value","onInput","onKeydown"],$t=["value","onInput","onKeydown"],Kt=["value","onInput","onKeydown"],Tt=["value","onInput","onKeydown"],Ct={class:"text-end"},Nt=["value","onInput","onKeydown"],Vt=["value","onInput","onKeydown"],Et={class:"text-end"},kt=["onClick"],St=["onClick"],At={class:"table-info"},Dt={class:"font-bold text-end"},qt={class:"font-bold text-end"},Bt={class:"font-bold text-end"},Gt={class:"font-bold text-end"},Pt={__name:"Editbilldata",props:{invoiceitem:Object},setup(U){const W=at({}),F=U,n=g([]),E=g([]),K=g(!0),i=g({}),d=g({}),T=g(null),u=g({}),m=(t,l)=>{l&&(u.value[t]=l)};ot(()=>{F.invoiceitem&&F.invoiceitem.length>0?n.value=F.invoiceitem.map(t=>[t.desc_product||"",t.hsn_code||"",parseFloat(t.quantity)||0,t.unit||"",parseFloat(t.weight)||0,parseFloat(t.rate)||0,parseFloat(t.gst_percentage)||0,parseFloat(t.gst_amount)||0]):n.value=[["","",0,"",0,0,0,0]]});const j=()=>{K.value=!K.value},p=(t,l,s)=>{t.shiftKey?(t.preventDefault(),Q(l,s)):(t.preventDefault(),L(l,s))},L=(t,l)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(l<s.length-1){const e=`${s[l+1]}-${t}`;b(()=>{u.value[e]&&u.value[e].focus()})}else if(t<n.value.length-1){const e=`${s[0]}-${t+1}`;b(()=>{u.value[e]&&u.value[e].focus()})}else A(t),b(()=>{const e=t+1,a=`${s[0]}-${e}`;u.value[a]&&u.value[a].focus()})},Q=(t,l)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(l>0){const e=`${s[l-1]}-${t}`;b(()=>{u.value[e]&&u.value[e].focus()})}else if(t>0){const e=`${s[s.length-1]}-${t-1}`;b(()=>{u.value[e]&&u.value[e].focus()})}},v=(t,l,s)=>{let e=s.target.value;if([2,4,5,6,7].includes(l)){const a=parseFloat(e);e=isNaN(a)?0:a}n.value[t][l]=e,[2,5].includes(l)&&tt(t)},J=async(t,l)=>{const s=l.target.value;if(v(t,1,l),T.value&&clearTimeout(T.value),!s.trim()){d.value[t]=!1,i.value[t]=[];return}T.value=setTimeout(async()=>{try{const e=await dt.get("/hsn/search",{params:{q:s}});i.value[t]=e.data,d.value[t]=!0}catch(e){console.error("Error searching HSN codes:",e),i.value[t]=[]}},300)},X=t=>{setTimeout(()=>{d.value[t]=!1},200)},Y=t=>{d.value[t]=!1},Z=t=>{i.value[t]&&i.value[t].length>0&&k(t,i.value[t][0])},k=(t,l)=>{n.value[t][1]=l.code,d.value[t]=!1,i.value[t]=[],b(()=>{const s=`quantity-${t}`;u.value[s]&&u.value[s].focus()})},x=(t,l)=>{v(t,6,l),S(t)},w=(t,l)=>{v(t,7,l),I(t)},S=t=>{const l=parseFloat(n.value[t][6])||0,e=(parseFloat(y(t))||0)*l/100;n.value[t][7]=parseFloat(e.toFixed(2))},I=t=>{const l=parseFloat(n.value[t][7])||0,s=parseFloat(y(t))||0;if(s>0){const e=l/s*100;n.value[t][6]=parseFloat(e.toFixed(2))}},tt=t=>{(parseFloat(n.value[t][6])||0)>0&&S(t)},A=t=>{const l=["","",0,"",0,0,0,0];n.value.splice(t+1,0,l),b(()=>{})},et=t=>{n.value.length>1&&(n.value.splice(t,1),Object.keys(u.value).forEach(l=>{l.includes(`-${t}`)&&delete u.value[l]}),delete i.value[t],delete d.value[t])},y=t=>{const l=parseFloat(n.value[t][2])||0,s=parseFloat(n.value[t][5])||0;return(l*s).toFixed(2)},D=t=>{const l=parseFloat(y(t))||0,s=parseFloat(n.value[t][7])||0;return(l+s).toFixed(2)},q=()=>n.value.reduce((t,l)=>t+(parseFloat(l[4])||0),0).toFixed(2),B=()=>n.value.reduce((t,l,s)=>t+parseFloat(y(s)),0).toFixed(2),G=()=>n.value.reduce((t,l)=>t+(parseFloat(l[7])||0),0).toFixed(2),P=()=>n.value.reduce((t,l,s)=>t+parseFloat(D(s)),0).toFixed(2),lt=()=>{var $,C,R,H,O,M;const t=(($=document.getElementById("invoice_no"))==null?void 0:$.value)||"",l=((C=document.getElementById("customer"))==null?void 0:C.value)||"",s=((R=document.getElementById("company"))==null?void 0:R.value)||"",e=((H=document.getElementById("vehical_no"))==null?void 0:H.value)||"";if(!t||!l||!s||!e){alert("Please fill in all required fields (Invoice No, Customer, Company, Vehicle No)");return}if(!n.value.some(_=>_[0].trim()!==""||_[1].trim()!==""||parseFloat(_[2])>0)){alert("Please add at least one item to the invoice");return}E.value[0]={invoice:t,customer:l,company:s,vehical_no:e,totalWeight:q(),totalTaxableValue:B(),totalGstAmount:G(),grandTotal:P()},W.post(route("gst.customer.bill.update",{invoicedata:n.value,invoice_id:(M=(O=F.invoiceitem)==null?void 0:O[0])==null?void 0:M.invoice_id,invoicedetails:E.value}),{preserveScroll:!0,onSuccess:()=>{},onError:_=>{console.error("Update errors:",_)}})};return(t,l)=>(f(),h(N,null,[o("div",{class:"mt-5 bg-purple-700 rounded-md position-relative"},[l[1]||(l[1]=o("h2",{class:"font-medium text-center text-white font-weight-bolder"}," EDIT INVOICE ",-1)),o("span",{class:"text-white cursor-pointer top-2 right-2 position-absolute",onClick:j},[...l[0]||(l[0]=[o("i",{class:"fa-solid fa-bullseye"},null,-1)])])]),st(ut,{name:"slide-fade"},{default:nt(()=>[K.value?(f(),h("div",vt,[o("div",ft,[o("table",ht,[l[8]||(l[8]=o("thead",{class:"table-dark"},[o("tr",null,[o("th",null,"S.NO."),o("th",null,"Description of Product"),o("th",null,"HSN Code"),o("th",null,"Quantity"),o("th",null,"Unit"),o("th",null,"Weight"),o("th",null,"Rate"),o("th",null,"Taxable Value"),o("th",null,"GST %"),o("th",null,"GST Amount"),o("th",null,"Subtotal"),o("th",null,"Action")])],-1)),o("tbody",null,[(f(!0),h(N,null,z(n.value,(s,e)=>(f(),h("tr",{key:`row-${e}`},[o("td",null,r(e+1),1),o("td",null,[o("input",{type:"text",value:s[0],onInput:a=>v(e,0,a),onKeydown:c(a=>p(a,e,0),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter description"},null,40,mt)]),o("td",gt,[o("input",{type:"text",value:s[1],onInput:a=>J(e,a),onFocus:a=>d.value[e]=!0,onBlur:a=>X(e),onKeydown:[c(a=>p(a,e,1),["tab"]),c(a=>Z(e),["enter"]),c(a=>Y(e),["escape"])],class:"form-control border-0 p-1",placeholder:"Enter HSN Code",autocomplete:"off",ref_for:!0,ref:a=>m(`hsn-${e}`,a)},null,40,bt),d.value[e]&&i.value[e]&&i.value[e].length>0?(f(),h("div",yt,[(f(!0),h(N,null,z(i.value[e],(a,$)=>(f(),h("div",{key:a.code,onMousedown:it(C=>k(e,a),["prevent"]),class:ct(["dropdown-item cursor-pointer hover-item",{active:$===0}]),style:{"font-size":"12px",padding:"8px 12px"}},[o("strong",null,r(a.code),1),rt(" - "+r(a.description),1)],42,_t))),128))])):V("",!0)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[2],onInput:a=>v(e,2,a),onKeydown:c(a=>p(a,e,2),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>m(`quantity-${e}`,a)},null,40,Ft)]),o("td",null,[o("input",{type:"text",value:s[3],onInput:a=>v(e,3,a),onKeydown:c(a=>p(a,e,3),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter unit",ref_for:!0,ref:a=>m(`unit-${e}`,a)},null,40,$t)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[4],onInput:a=>v(e,4,a),onKeydown:c(a=>p(a,e,4),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>m(`weight-${e}`,a)},null,40,Kt)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[5],onInput:a=>v(e,5,a),onKeydown:c(a=>p(a,e,5),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>m(`rate-${e}`,a)},null,40,Tt)]),o("td",Ct,r(y(e)),1),o("td",null,[o("input",{type:"number",step:"0.01",min:"0",max:"100",value:s[6],onInput:a=>x(e,a),onKeydown:c(a=>p(a,e,6),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>m(`gst-percentage-${e}`,a)},null,40,Nt)]),o("td",null,[o("input",{type:"number",step:"0.01",min:"0",value:s[7],onInput:a=>w(e,a),onKeydown:c(a=>p(a,e,7),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>m(`gst-amount-${e}`,a)},null,40,Vt)]),o("td",Et,r(D(e)),1),o("td",null,[o("span",{class:"cursor-pointer badge rounded-pill text-bg-primary me-2",onClick:a=>A(e)},[...l[2]||(l[2]=[o("i",{class:"fa fa-plus","aria-hidden":"true"},null,-1)])],8,kt),n.value.length>1?(f(),h("span",{key:0,class:"cursor-pointer badge rounded-pill text-bg-danger",onClick:a=>et(e)},[...l[3]||(l[3]=[o("i",{class:"fa fa-minus","aria-hidden":"true"},null,-1)])],8,St)):V("",!0)])]))),128)),o("tr",At,[l[4]||(l[4]=o("td",{colspan:"5",class:"text-end font-bold"},"TOTALS:",-1)),o("td",Dt,r(q()),1),l[5]||(l[5]=o("td",null,null,-1)),o("td",qt,r(B()),1),l[6]||(l[6]=o("td",null,null,-1)),o("td",Bt,r(G()),1),o("td",Gt,r(P()),1),l[7]||(l[7]=o("td",null,null,-1))])])])]),o("button",{class:"text-white btn btn-info text-bold mt-3",onClick:lt}," Update Invoice ")])):V("",!0)]),_:1})],64))}},Ot=pt(Pt,[["__scopeId","data-v-49d78a32"]]);export{Ot as default};
