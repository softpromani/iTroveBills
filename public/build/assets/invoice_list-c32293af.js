import{p,g as q,s as re,z as ie,o as n,c as r,a as y,u as h,w,F as b,Z as ue,b as e,e as C,h as c,Y as U,x as S,t as a,k as x,d as u,f as d,n as de,i as $,j as me,A as pe,N as G,y as j}from"./app-5e77b17f.js";import{_ as ce}from"./AuthenticatedLayout-2ebda813.js";import{_ as ve}from"./Pagination-39ac60e2.js";import{S as v}from"./sweetalert2.esm.all-263d9c0b.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./FlashMessages-a2638689.js";const fe={class:"bg-white rounded-lg shadow mb-4 p-4"},ge={class:"form-group"},ye=["value"],be={class:"form-group"},xe={class:"form-group"},_e=["value"],ke={class:"form-group"},he=["value"],we={key:0,class:"mt-3"},Ce={class:"flex flex-wrap gap-2 mt-1"},Se={key:0,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800"},Ae={key:1,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800"},Pe={key:2,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-purple-100 text-purple-800"},Ne={key:3,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},Ve={key:4,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"},Fe={key:5,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},Be={key:6,class:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800"},Me={class:"bg-white rounded-lg shadow mb-4 p-4"},Te={class:"flex justify-between items-center"},Ee={class:"text-sm text-gray-600"},Oe={class:"flex items-center gap-2"},Ue={class:"bg-white rounded-lg shadow"},$e={class:"rounded-lg table-responsive"},je={class:"table",style:{"min-height":"200px"}},De={key:0},Ie={class:"dropdown"},qe={class:"dropdown-menu"},Ke=["onClick"],Le=["onClick"],Ye={class:"flex flex-col items-center px-4 py-3 bg-white border-t sm:flex-row sm:justify-between"},He={class:"text-sm text-gray-700 mb-2 sm:mb-0"},Re={class:"font-medium"},Ze={class:"font-medium"},ze={class:"font-medium"},We={class:"flex items-center gap-4"},Je={class:"text-sm text-gray-500"},Ge={key:0,class:"modal fade show",style:{display:"block"},"aria-modal":"true",role:"dialog"},Qe={class:"modal-dialog",role:"document"},Xe={class:"modal-content"},et={class:"modal-body"},tt={class:"form-group mb-3"},lt={class:"form-group mb-3"},st={key:1,class:"modal-backdrop fade show"},ot={key:2,class:"modal fade show",style:{display:"block"},"aria-modal":"true",role:"dialog"},at={class:"modal-dialog",role:"document"},nt={class:"modal-content"},rt={class:"modal-body"},it={class:"mb-3"},ut=["id","value"],dt=["for"],mt={class:"form-group mb-3"},pt={class:"form-group mb-3"},ct={class:"form-group mb-3"},vt={key:3,class:"modal-backdrop fade show"},kt={__name:"invoice_list",props:{invoices:{type:[Object,Array],default:()=>({})},customers:{type:Array,default:()=>[]},paymentStatuses:{type:Array,default:()=>[]},financialYears:{type:Array,default:()=>[]}},setup(A){const i=A,o=p({customer_id:"",customer_name:"",financial_year:"",payment_status:"",start_date:"",end_date:"",min_amount:"",max_amount:"",per_page:"20"}),P=p(!1),N=p(!1),_=p(""),k=p(""),f=p(null),V=p(""),F=p(""),B=p(""),M=p(""),K=p([]),T=q(()=>{if(i.invoices&&typeof i.invoices=="object"){if(i.invoices.data&&Array.isArray(i.invoices.data))return i.invoices.data;if(Array.isArray(i.invoices))return i.invoices}return[]}),m=q(()=>i.invoices&&typeof i.invoices=="object"&&"data"in i.invoices&&"current_page"in i.invoices?{from:i.invoices.from||0,to:i.invoices.to||0,total:i.invoices.total||0,current_page:i.invoices.current_page||1,last_page:i.invoices.last_page||1,per_page:i.invoices.per_page||20,links:i.invoices.links||[],prev_page_url:i.invoices.prev_page_url,next_page_url:i.invoices.next_page_url}:{from:0,to:0,total:T.value.length,current_page:1,last_page:1,per_page:20,links:[]}),L=q(()=>{const s={...o.value};return delete s.per_page,Object.values(s).some(t=>t!=="")}),Q=s=>(m.value.current_page-1)*m.value.per_page+s+1,E=()=>{const s={};Object.keys(o.value).forEach(t=>{o.value[t]!==""&&(s[t]=o.value[t])}),G.get(route("invoice.list"),s,{preserveState:!0,preserveScroll:!1,replace:!1})},X=()=>{Object.keys(o.value).forEach(s=>{s==="per_page"?o.value[s]="20":o.value[s]=""}),G.get(route("invoice.list"),{per_page:"20"},{preserveState:!0,preserveScroll:!0})},ee=s=>{if(!s||!i.customers)return"";const t=i.customers.find(l=>l.id==s);return t?t.name:""},te=s=>{if(!s)return"";try{return new Date(s).toLocaleDateString("en-IN")}catch{return s}},Y=s=>{if(!s)return"0.00";try{return parseFloat(s).toLocaleString("en-IN",{minimumFractionDigits:2,maximumFractionDigits:2})}catch{return s}},le=s=>{P.value=!0,f.value=s,j.get(`/api/fetch-invoice/${s}`).then(t=>{const l=t.data;_.value=l.no_packets||"",k.value=l.vehicle_no||""}).catch(t=>{console.error("Error fetching invoice:",t),v.fire({title:"Error!",text:"Failed to fetch invoice data.",icon:"error",confirmButtonText:"OK"})})},D=()=>{P.value=!1,_.value="",k.value="",f.value=null},se=()=>{j.post("/api/update-invoice-package",{no_packets:_.value,vehicle_no:k.value,invoice_id:f.value}).then(s=>{v.fire({title:"Success!",text:"Package updated successfully.",icon:"success",confirmButtonText:"OK"}).then(()=>{location.reload()}),D()}).catch(s=>{console.error("Error updating package:",s),v.fire({title:"Error!",text:"There was an error updating the package.",icon:"error",confirmButtonText:"OK"})})},oe=s=>{N.value=!0,f.value=s,j.get("/api/fetch-payment-types").then(t=>{K.value=t.data}).catch(t=>{console.error("Error fetching payment types:",t),v.fire({title:"Error!",text:"Failed to fetch payment types.",icon:"error",confirmButtonText:"OK"})})},I=()=>{N.value=!1,F.value="",V.value="",B.value="",M.value="",f.value=null},ae=()=>{j.post("/api/pay-bill",{payment_method_id:F.value,reference_no:V.value,amount:B.value,remark:M.value,invoice_id:f.value}).then(s=>{s.data.status==1?v.fire({title:"Success!",text:s.data.message,icon:"success",confirmButtonText:"OK"}).then(()=>{location.reload()}):v.fire({title:"Info!",text:s.data.message,icon:"warning",confirmButtonText:"OK"}),I()}).catch(s=>{console.error("Error paying bill:",s),v.fire({title:"Error!",text:"There was an error paying the bill.",icon:"error",confirmButtonText:"OK"})})};re(()=>{const s=new URLSearchParams(window.location.search);Object.keys(o.value).forEach(t=>{s.has(t)&&(o.value[t]=s.get(t))}),s.has("per_page")||(o.value.per_page="20")});let H=null;return ie(o,(s,t)=>{const l={...s},g={...t};delete l.per_page,delete g.per_page,JSON.stringify(l)!==JSON.stringify(g)&&(clearTimeout(H),H=setTimeout(()=>{L.value&&E()},1e3))},{deep:!0}),(s,t)=>(n(),r(b,null,[y(h(ue),{title:"Invoice List"}),y(ce,null,{default:w(()=>[t[57]||(t[57]=e("div",{class:"inline-flex w-full mb-4 overflow-hidden bg-white rounded-lg shadow-md"},[e("div",{class:"flex items-center justify-center w-12 bg-pink-800"},[e("svg",{class:"w-6 h-6 text-white fill-current",viewBox:"0 0 40 40",xmlns:"http://www.w3.org/2000/svg"},[e("path",{d:"M20 3.33331C10.8 3.33331 3.33337 10.8 3.33337 20C3.33337 29.2 10.8 36.6666 20 36.6666C29.2 36.6666 36.6667 29.2 36.6667 20C36.6667 10.8 29.2 3.33331 20 3.33331ZM21.6667 28.3333H18.3334V25H21.6667V28.3333ZM21.6667 21.6666H18.3334V11.6666H21.6667V21.6666Z"})])]),e("div",{class:"px-4 py-2 -mx-3"},[e("div",{class:"mx-3"},[e("span",{class:"font-semibold text-blue-500"},"Invoice List")])])],-1)),e("div",fe,[t[28]||(t[28]=e("h3",{class:"text-lg font-semibold mb-4"},"Filters",-1)),e("form",{onSubmit:C(E,["prevent"]),class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},[e("div",ge,[t[19]||(t[19]=e("label",{for:"customer_id",class:"block text-sm font-medium text-gray-700 mb-1"},"Customer",-1)),c(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>o.value.customer_id=l),id:"customer_id",class:"form-control w-full"},[t[18]||(t[18]=e("option",{value:""},"All Customers",-1)),(n(!0),r(b,null,S(A.customers||[],l=>(n(),r("option",{key:l.id,value:l.id},a(l.name)+" ("+a(l.mobile)+") ",9,ye))),128))],512),[[U,o.value.customer_id]])]),e("div",be,[t[20]||(t[20]=e("label",{for:"customer_name",class:"block text-sm font-medium text-gray-700 mb-1"},"Search Customer",-1)),c(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>o.value.customer_name=l),type:"text",id:"customer_name",class:"form-control w-full",placeholder:"Enter customer name"},null,512),[[x,o.value.customer_name]])]),e("div",xe,[t[22]||(t[22]=e("label",{for:"financial_year",class:"block text-sm font-medium text-gray-700 mb-1"},"Financial Year",-1)),c(e("select",{"onUpdate:modelValue":t[2]||(t[2]=l=>o.value.financial_year=l),id:"financial_year",class:"form-control w-full"},[t[21]||(t[21]=e("option",{value:""},"All Years",-1)),(n(!0),r(b,null,S(A.financialYears||[],l=>(n(),r("option",{key:l.value,value:l.value},a(l.label),9,_e))),128))],512),[[U,o.value.financial_year]])]),e("div",ke,[t[24]||(t[24]=e("label",{for:"payment_status",class:"block text-sm font-medium text-gray-700 mb-1"},"Payment Status",-1)),c(e("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>o.value.payment_status=l),id:"payment_status",class:"form-control w-full"},[t[23]||(t[23]=e("option",{value:""},"All Status",-1)),(n(!0),r(b,null,S(A.paymentStatuses||[],l=>(n(),r("option",{key:l,value:l},a(l.charAt(0).toUpperCase()+l.slice(1).replace("-"," ")),9,he))),128))],512),[[U,o.value.payment_status]])])],32),e("div",{class:"flex gap-2 mt-4"},[e("button",{onClick:E,class:"btn btn-primary"},[...t[25]||(t[25]=[e("i",{class:"fa fa-filter mr-1"},null,-1),u(" Apply Filters ",-1)])]),e("button",{onClick:X,class:"btn btn-secondary"},[...t[26]||(t[26]=[e("i",{class:"fa fa-times mr-1"},null,-1),u(" Clear Filters ",-1)])])]),L.value?(n(),r("div",we,[t[27]||(t[27]=e("span",{class:"text-sm font-medium text-gray-600"},"Active Filters:",-1)),e("div",Ce,[o.value.customer_id?(n(),r("span",Se,[u(" Customer: "+a(ee(o.value.customer_id))+" ",1),e("button",{onClick:t[4]||(t[4]=l=>o.value.customer_id=""),class:"ml-1 text-blue-600 hover:text-blue-800"},"×")])):d("",!0),o.value.financial_year?(n(),r("span",Ae,[u(" FY: "+a(o.value.financial_year)+"-"+a(parseInt(o.value.financial_year)+1)+" ",1),e("button",{onClick:t[5]||(t[5]=l=>o.value.financial_year=""),class:"ml-1 text-green-600 hover:text-green-800"},"×")])):d("",!0),o.value.payment_status?(n(),r("span",Pe,[u(" Status: "+a(o.value.payment_status)+" ",1),e("button",{onClick:t[6]||(t[6]=l=>o.value.payment_status=""),class:"ml-1 text-purple-600 hover:text-purple-800"},"×")])):d("",!0),o.value.start_date?(n(),r("span",Ne,[u(" From: "+a(o.value.start_date)+" ",1),e("button",{onClick:t[7]||(t[7]=l=>o.value.start_date=""),class:"ml-1 text-yellow-600 hover:text-yellow-800"},"×")])):d("",!0),o.value.end_date?(n(),r("span",Ve,[u(" To: "+a(o.value.end_date)+" ",1),e("button",{onClick:t[8]||(t[8]=l=>o.value.end_date=""),class:"ml-1 text-yellow-600 hover:text-yellow-800"},"×")])):d("",!0),o.value.min_amount?(n(),r("span",Fe,[u(" Min: ₹"+a(o.value.min_amount)+" ",1),e("button",{onClick:t[9]||(t[9]=l=>o.value.min_amount=""),class:"ml-1 text-indigo-600 hover:text-indigo-800"},"×")])):d("",!0),o.value.max_amount?(n(),r("span",Be,[u(" Max: ₹"+a(o.value.max_amount)+" ",1),e("button",{onClick:t[10]||(t[10]=l=>o.value.max_amount=""),class:"ml-1 text-indigo-600 hover:text-indigo-800"},"×")])):d("",!0)])])):d("",!0)]),e("div",Me,[e("div",Te,[e("div",Ee," Showing "+a(m.value.from)+" to "+a(m.value.to)+" of "+a(m.value.total)+" results ",1),e("div",Oe,[t[30]||(t[30]=e("label",{for:"per_page",class:"text-sm text-gray-600"},"Show:",-1)),c(e("select",{"onUpdate:modelValue":t[11]||(t[11]=l=>o.value.per_page=l),id:"per_page",class:"form-control w-auto text-sm",onChange:E},[...t[29]||(t[29]=[e("option",{value:"10"},"10",-1),e("option",{value:"20"},"20",-1),e("option",{value:"50"},"50",-1),e("option",{value:"100"},"100",-1)])],544),[[U,o.value.per_page]]),t[31]||(t[31]=e("span",{class:"text-sm text-gray-600"},"per page",-1))])])]),e("div",Ue,[e("div",$e,[e("table",je,[t[40]||(t[40]=e("thead",{class:"table-dark"},[e("tr",null,[e("th",{class:"col-1"},"Sr.no."),e("th",{class:"col-1"},"Invoice Number"),e("th",{class:"col-1"},"Invoice Date"),e("th",{class:"col-1"},"Total Amount"),e("th",{class:"col-1"},"Paid Amount"),e("th",{class:"col-2"},"Payment Status"),e("th",{class:"col-1"},"Vehicle No"),e("th",{class:"col-1"},"No. Packets"),e("th",{class:"col-1"},"Customer"),e("th",{class:"col-1"},"Company"),e("th",{class:"col-1"},"Action")])],-1)),e("tbody",null,[!T.value||T.value.length===0?(n(),r("tr",De,[...t[32]||(t[32]=[e("td",{colspan:"11",class:"text-center py-4"},[e("div",{class:"text-gray-500"},[e("i",{class:"fa fa-inbox fa-3x mb-3"}),e("p",null,"No invoices found matching your criteria")])],-1)])])):d("",!0),(n(!0),r(b,null,S(T.value,(l,g)=>{var O,R,Z,z,W,J;return n(),r("tr",{key:l.id},[e("td",null,a(Q(g)),1),e("td",null,a(l.invoice_number||""),1),e("td",null,a(te(l.invoice_date)),1),e("td",null,"₹"+a(Y(l.total_ammount)),1),e("td",null,"₹"+a(Y((O=l.payment)==null?void 0:O.paid_amount)),1),e("td",null,[e("span",{class:de(["px-3 py-1 mr-2 text-xs font-medium rounded-full",{"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":((R=l.payment)==null?void 0:R.status)==="due","bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":((Z=l.payment)==null?void 0:Z.status)==="partial-paid","bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":((z=l.payment)==null?void 0:z.status)==="paid"}])},a(((W=l.payment)==null?void 0:W.status)||"N/A"),3)]),e("td",null,a(l.vehicle_no||"N/A"),1),e("td",null,a(l.no_packets||"NO PACK"),1),e("td",null,a(l.customer.company_name||"N/A"),1),e("td",null,a(((J=l.company)==null?void 0:J.company_name)||"N?A"),1),e("td",null,[e("div",Ie,[t[39]||(t[39]=e("span",{class:"p-2",style:{"font-size":"15px",cursor:"pointer"},"data-bs-toggle":"dropdown","aria-expanded":"false"},[e("i",{class:"fa fa-ellipsis-v"})],-1)),e("ul",qe,[e("li",null,[y(h($),{class:"dropdown-item",href:s.route("customer.bill.edit"),method:"get",data:{invoice_id:l.id}},{default:w(()=>[...t[33]||(t[33]=[e("i",{class:"fa-solid fa-pen-to-square",style:{color:"blueviolet"}},null,-1),u(" Edit ",-1)])]),_:2},1032,["href","data"])]),e("li",null,[y(h($),{href:s.route("view.invoice"),method:"get",data:{invoice_id:l.id},class:"dropdown-item"},{default:w(()=>[...t[34]||(t[34]=[e("i",{class:"fa fa-print","aria-hidden":"true",style:{color:"rgb(241, 12, 12)"}},null,-1),u(" Print ",-1)])]),_:2},1032,["href","data"])]),e("li",null,[y(h($),{class:"dropdown-item",href:s.route("bill.sendmail"),method:"post",data:{invoice_id:l.id}},{default:w(()=>[...t[35]||(t[35]=[e("i",{class:"fa fa-envelope-square","aria-hidden":"true",style:{color:"rgb(245, 180, 0)"}},null,-1),u(" Mail ",-1)])]),_:2},1032,["href","data"])]),e("li",null,[y(h($),{class:"dropdown-item",href:s.route("create.eway.bill"),method:"get",data:{invoice_id:l.id,type:"regular"}},{default:w(()=>[...t[36]||(t[36]=[e("i",{class:"fa fa-envelope-square","aria-hidden":"true",style:{color:"rgb(245, 180, 0)"}},null,-1),u(" Generate E-Way Bill ",-1)])]),_:2},1032,["href","data"])]),e("li",null,[e("a",{onClick:C(ne=>le(l.id),["prevent"]),class:"dropdown-item",href:"#"},[...t[37]||(t[37]=[e("i",{class:"fa fa-car","aria-hidden":"true",style:{color:"rgb(245, 180, 0)"}},null,-1),u(" Package Update ",-1)])],8,Ke)]),e("li",null,[e("a",{onClick:C(ne=>oe(l.id),["prevent"]),class:"dropdown-item",href:"#"},[...t[38]||(t[38]=[e("i",{class:"fa fa-inr","aria-hidden":"true",style:{color:"rgb(245, 180, 0)"}},null,-1),u(" Pay Bill ",-1)])],8,Le)])])])])])}),128))])])]),e("div",Ye,[e("div",He,[t[41]||(t[41]=u(" Showing ",-1)),e("span",Re,a(m.value.from),1),t[42]||(t[42]=u(" to ",-1)),e("span",Ze,a(m.value.to),1),t[43]||(t[43]=u(" of ",-1)),e("span",ze,a(m.value.total),1),t[44]||(t[44]=u(" results ",-1))]),e("div",We,[e("div",Je," Page "+a(m.value.current_page)+" of "+a(m.value.last_page),1),m.value.links&&m.value.links.length>3?(n(),me(ve,{key:0,links:m.value.links},null,8,["links"])):d("",!0)])])]),P.value?(n(),r("div",Ge,[e("div",Qe,[e("div",Xe,[e("div",{class:"modal-header"},[t[46]||(t[46]=e("h5",{class:"modal-title"},"Update Package",-1)),e("button",{type:"button",class:"close",onClick:D},[...t[45]||(t[45]=[e("span",null,"×",-1)])])]),e("div",et,[e("form",{onSubmit:C(se,["prevent"])},[e("div",tt,[t[47]||(t[47]=e("label",{for:"no_packets"},"No. of Package",-1)),c(e("input",{type:"number",class:"form-control",id:"no_packets","onUpdate:modelValue":t[12]||(t[12]=l=>_.value=l),required:""},null,512),[[x,_.value]])]),e("div",lt,[t[48]||(t[48]=e("label",{for:"vehicle_no"},"Vehicle Number",-1)),c(e("input",{type:"text",class:"form-control",id:"vehicle_no","onUpdate:modelValue":t[13]||(t[13]=l=>k.value=l),required:""},null,512),[[x,k.value]])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:D},"Close"),t[49]||(t[49]=e("button",{type:"submit",class:"btn btn-primary"},"Save changes",-1))])],32)])])])])):d("",!0),P.value?(n(),r("div",st)):d("",!0),N.value?(n(),r("div",ot,[e("div",at,[e("div",nt,[e("div",{class:"modal-header"},[t[51]||(t[51]=e("h5",{class:"modal-title"},"Pay Bill",-1)),e("button",{type:"button",class:"close",onClick:I},[...t[50]||(t[50]=[e("span",null,"×",-1)])])]),e("div",rt,[e("form",{onSubmit:C(ae,["prevent"])},[e("fieldset",it,[t[52]||(t[52]=e("legend",{class:"col-form-label pt-0"},"Payment Method",-1)),(n(!0),r(b,null,S(K.value,(l,g)=>(n(),r("div",{key:g,class:"form-check form-check-inline"},[c(e("input",{class:"form-check-input",type:"radio",id:l.name,value:l.id,"onUpdate:modelValue":t[14]||(t[14]=O=>F.value=O)},null,8,ut),[[pe,F.value]]),e("label",{class:"form-check-label",for:l.name},a(l.name),9,dt)]))),128))]),e("div",mt,[t[53]||(t[53]=e("label",{for:"reference_no"},"Reference Number",-1)),c(e("input",{type:"text",class:"form-control",id:"reference_no","onUpdate:modelValue":t[15]||(t[15]=l=>V.value=l),required:""},null,512),[[x,V.value]])]),e("div",pt,[t[54]||(t[54]=e("label",{for:"amount"},"Amount",-1)),c(e("input",{type:"number",class:"form-control",id:"amount","onUpdate:modelValue":t[16]||(t[16]=l=>B.value=l),required:""},null,512),[[x,B.value]])]),e("div",ct,[t[55]||(t[55]=e("label",{for:"remark"},"Remark (if any)",-1)),c(e("textarea",{class:"form-control",id:"remark","onUpdate:modelValue":t[17]||(t[17]=l=>M.value=l)},null,512),[[x,M.value]])]),e("div",{class:"modal-footer"},[e("button",{type:"button",class:"btn btn-secondary",onClick:I},"Close"),t[56]||(t[56]=e("button",{type:"submit",class:"btn btn-primary"},"Submit",-1))])],32)])])])])):d("",!0),N.value?(n(),r("div",vt)):d("",!0)]),_:1})],64))}};export{kt as default};
