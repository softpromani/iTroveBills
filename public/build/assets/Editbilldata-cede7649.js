import{T as ae,p as y,s as se,z as ne,o as r,c as d,b as a,a as ie,w as ue,q as ce,F as T,x as q,t as v,D as f,e as re,n as de,d as pe,f as k,u as C,y as ve,E as F,N as z}from"./app-52e465e7.js";import{_ as fe}from"./_plugin-vue_export-helper-c27b6911.js";const he={key:0},ge={class:"rounded-lg shadow table-responsive"},_e={class:"table table-bordered"},be=["value","onInput","onKeydown"],me={class:"position-relative"},ye=["value","onInput","onFocus","onBlur","onKeydown"],Fe={key:0,class:"dropdown-menu show position-absolute w-100",style:{top:"100%","z-index":"1000","max-height":"200px","overflow-y":"auto"}},$e=["onMousedown"],Ke=["value","onInput","onKeydown"],Te=["value","onInput","onKeydown"],ke=["value","onInput","onKeydown"],Ce=["value","onInput","onKeydown"],Ne={class:"text-end"},Ve=["value","onInput","onKeydown"],Ee=["value","onInput","onKeydown"],qe={class:"text-end"},Ae=["onClick"],Se=["onClick"],Pe={class:"table-info"},De={class:"font-bold text-end"},Ge={class:"font-bold text-end"},Re={class:"font-bold text-end"},He={class:"font-bold text-end"},Ue={class:"mt-3 d-flex gap-2"},Be=["disabled"],Oe={key:0},Me={key:1},ze={key:0,class:"alert alert-danger mt-3"},je={class:"mb-0"},Le={__name:"Editbilldata",props:{invoicedetails:Object,invoiceitem:Array,invoiceId:[String,Number]},setup(j){const u=j,i=ae({invoicedata:[],invoicedetails:[],invoice_id:null}),n=y([]),N=y(!0),p=y({}),h=y({}),V=y(null),c=y({}),A=y(!1),b=(e,t)=>{t&&(c.value[e]=t)};se(()=>{var e;console.log("Mounted - Props received:",{invoicedetails:u.invoicedetails,invoiceitem:u.invoiceitem,invoiceId:u.invoiceId}),i.invoice_id=u.invoiceId||((e=u.invoicedetails)==null?void 0:e.id),u.invoiceitem&&u.invoiceitem.length>0?n.value=u.invoiceitem.map(t=>[t.desc_product||"",t.hsn_code||"",parseFloat(t.quantity)||0,t.unit||"",parseFloat(t.weight)||0,parseFloat(t.rate)||0,parseFloat(t.gst_percentage)||0,parseFloat(t.gst_amount)||0]):n.value=[["","",0,"",0,0,0,0]],console.log("Initial table data:",n.value)}),ne(()=>u.invoiceitem,e=>{e&&e.length>0&&(n.value=e.map(t=>[t.desc_product||"",t.hsn_code||"",parseFloat(t.quantity)||0,t.unit||"",parseFloat(t.weight)||0,parseFloat(t.rate)||0,parseFloat(t.gst_percentage)||0,parseFloat(t.gst_amount)||0]))},{deep:!0});const L=()=>{N.value=!N.value},g=(e,t,s)=>{e.shiftKey?(e.preventDefault(),Q(t,s)):(e.preventDefault(),W(t,s))},W=(e,t)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(t<s.length-1){const l=`${s[t+1]}-${e}`;F(()=>{c.value[l]&&c.value[l].focus()})}else if(e<n.value.length-1){const l=`${s[0]}-${e+1}`;F(()=>{c.value[l]&&c.value[l].focus()})}else D(e),F(()=>{const l=e+1,o=`${s[0]}-${l}`;c.value[o]&&c.value[o].focus()})},Q=(e,t)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(t>0){const l=`${s[t-1]}-${e}`;F(()=>{c.value[l]&&c.value[l].focus()})}else if(e>0){const l=`${s[s.length-1]}-${e-1}`;F(()=>{c.value[l]&&c.value[l].focus()})}},_=(e,t,s)=>{let l=s.target.value;if([2,4,5,6,7].includes(t)){const o=parseFloat(l);l=isNaN(o)?0:o}n.value[e][t]=l,[2,5].includes(t)&&ee(e)},J=async(e,t)=>{const s=t.target.value;if(_(e,1,t),V.value&&clearTimeout(V.value),!s.trim()){h.value[e]=!1,p.value[e]=[];return}V.value=setTimeout(async()=>{try{const l=await ve.get("/hsn/search",{params:{q:s}});p.value[e]=l.data,h.value[e]=!0}catch(l){console.error("Error searching HSN codes:",l),p.value[e]=[]}},300)},X=e=>{setTimeout(()=>{h.value[e]=!1},200)},Y=e=>{h.value[e]=!1},Z=e=>{p.value[e]&&p.value[e].length>0&&S(e,p.value[e][0])},S=(e,t)=>{n.value[e][1]=t.code,h.value[e]=!1,p.value[e]=[],F(()=>{const s=`quantity-${e}`;c.value[s]&&c.value[s].focus()})},x=(e,t)=>{_(e,6,t),P(e)},w=(e,t)=>{_(e,7,t),I(e)},P=e=>{const t=parseFloat(n.value[e][6])||0,l=(parseFloat($(e))||0)*t/100;n.value[e][7]=parseFloat(l.toFixed(2))},I=e=>{const t=parseFloat(n.value[e][7])||0,s=parseFloat($(e))||0;if(s>0){const l=t/s*100;n.value[e][6]=parseFloat(l.toFixed(2))}},ee=e=>{(parseFloat(n.value[e][6])||0)>0&&P(e)},D=e=>{const t=["","",0,"",0,0,0,0];n.value.splice(e+1,0,t),F(()=>{})},te=e=>{n.value.length>1&&(n.value.splice(e,1),Object.keys(c.value).forEach(t=>{t.includes(`-${e}`)&&delete c.value[t]}),delete p.value[e],delete h.value[e])},$=e=>{const t=parseFloat(n.value[e][2])||0,s=parseFloat(n.value[e][5])||0;return(t*s).toFixed(2)},G=e=>{const t=parseFloat($(e))||0,s=parseFloat(n.value[e][7])||0;return(t+s).toFixed(2)},R=()=>n.value.reduce((e,t)=>e+(parseFloat(t[4])||0),0).toFixed(2),H=()=>n.value.reduce((e,t,s)=>e+parseFloat($(s)),0).toFixed(2),U=()=>n.value.reduce((e,t)=>e+(parseFloat(t[7])||0),0).toFixed(2),B=()=>n.value.reduce((e,t,s)=>e+parseFloat(G(s)),0).toFixed(2),le=()=>{var t,s,l,o,K,E,O,M;if(console.log("Update bill function called"),console.log("Current form data:",i),console.log("Current table data:",n.value),console.log("Invoice details from props:",u.invoicedetails),!((t=u.invoicedetails)!=null&&t.invoice_no)&&!i.invoice_no){alert("Invoice number is required");return}if(!((s=u.invoicedetails)!=null&&s.customer)&&!i.customer){alert("Customer is required");return}if(!((l=u.invoicedetails)!=null&&l.company)&&!i.company){alert("Company is required");return}if(!((o=u.invoicedetails)!=null&&o.vehical_no)&&!i.vehical_no){alert("Vehicle number is required");return}if(!n.value.some(m=>m[0].trim()!==""||m[1].trim()!==""||parseFloat(m[2])>0)){alert("Please add at least one item to the invoice");return}i.clearErrors(),i.invoicedata=n.value,i.invoicedetails=[{invoice:((K=u.invoicedetails)==null?void 0:K.invoice_no)||i.invoice_no,customer:((E=u.invoicedetails)==null?void 0:E.customer)||i.customer,company:((O=u.invoicedetails)==null?void 0:O.company)||i.company,vehical_no:((M=u.invoicedetails)==null?void 0:M.vehical_no)||i.vehical_no,totalWeight:R(),totalTaxableValue:H(),totalGstAmount:U(),grandTotal:B()}],console.log("Submitting data:",{invoicedata:i.invoicedata,invoicedetails:i.invoicedetails,invoice_id:i.invoice_id}),A.value=!0,i.post(route("gst.customer.bill.update",{invoice_id:i.invoice_id}),{preserveScroll:!0,onSuccess:m=>{console.log("Update successful:",m),alert("Invoice updated successfully!"),z.visit(route("gst.invoice.list"))},onError:m=>{console.error("Update errors:",m),alert("Error updating invoice. Please check the form and try again.")},onFinish:()=>{A.value=!1}})},oe=()=>{confirm("Are you sure you want to cancel? Any unsaved changes will be lost.")&&z.visit(route("gst.invoice.list"))};return(e,t)=>(r(),d(T,null,[a("div",{class:"mt-5 bg-purple-700 rounded-md position-relative py-2 px-3"},[t[1]||(t[1]=a("h2",{class:"text-sm font-medium text-center text-white font-weight-bolder mb-0"}," EDIT INVOICE ",-1)),a("span",{class:"text-white cursor-pointer top-2 right-3 position-absolute",onClick:L},[...t[0]||(t[0]=[a("i",{class:"fa-solid fa-bullseye fa-lg"},null,-1)])])]),ie(ce,{name:"slide-fade"},{default:ue(()=>[N.value?(r(),d("div",he,[a("div",ge,[a("table",_e,[t[8]||(t[8]=a("thead",{class:"table-dark"},[a("tr",null,[a("th",null,"S.NO."),a("th",null,"Description of Product"),a("th",null,"HSN Code"),a("th",null,"Quantity"),a("th",null,"Unit"),a("th",null,"Weight"),a("th",null,"Rate"),a("th",null,"Taxable Value"),a("th",null,"GST %"),a("th",null,"GST Amount"),a("th",null,"Subtotal"),a("th",null,"Action")])],-1)),a("tbody",null,[(r(!0),d(T,null,q(n.value,(s,l)=>(r(),d("tr",{key:`row-${l}`},[a("td",null,v(l+1),1),a("td",null,[a("input",{type:"text",value:s[0],onInput:o=>_(l,0,o),onKeydown:f(o=>g(o,l,0),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter description"},null,40,be)]),a("td",me,[a("input",{type:"text",value:s[1],onInput:o=>J(l,o),onFocus:o=>h.value[l]=!0,onBlur:o=>X(l),onKeydown:[f(o=>g(o,l,1),["tab"]),f(o=>Z(l),["enter"]),f(o=>Y(l),["escape"])],class:"form-control border-0 p-1",placeholder:"Enter HSN Code",autocomplete:"off",ref_for:!0,ref:o=>b(`hsn-${l}`,o)},null,40,ye),h.value[l]&&p.value[l]&&p.value[l].length>0?(r(),d("div",Fe,[(r(!0),d(T,null,q(p.value[l],(o,K)=>(r(),d("div",{key:o.code,onMousedown:re(E=>S(l,o),["prevent"]),class:de(["dropdown-item cursor-pointer hover-item",{active:K===0}]),style:{"font-size":"12px",padding:"8px 12px"}},[a("strong",null,v(o.code),1),pe(" - "+v(o.description),1)],42,$e))),128))])):k("",!0)]),a("td",null,[a("input",{type:"number",step:"0.01",value:s[2],onInput:o=>_(l,2,o),onKeydown:f(o=>g(o,l,2),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:o=>b(`quantity-${l}`,o)},null,40,Ke)]),a("td",null,[a("input",{type:"text",value:s[3],onInput:o=>_(l,3,o),onKeydown:f(o=>g(o,l,3),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter unit",ref_for:!0,ref:o=>b(`unit-${l}`,o)},null,40,Te)]),a("td",null,[a("input",{type:"number",step:"0.01",value:s[4],onInput:o=>_(l,4,o),onKeydown:f(o=>g(o,l,4),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:o=>b(`weight-${l}`,o)},null,40,ke)]),a("td",null,[a("input",{type:"number",step:"0.01",value:s[5],onInput:o=>_(l,5,o),onKeydown:f(o=>g(o,l,5),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:o=>b(`rate-${l}`,o)},null,40,Ce)]),a("td",Ne,v($(l)),1),a("td",null,[a("input",{type:"number",step:"0.01",min:"0",max:"100",value:s[6],onInput:o=>x(l,o),onKeydown:f(o=>g(o,l,6),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:o=>b(`gst-percentage-${l}`,o)},null,40,Ve)]),a("td",null,[a("input",{type:"number",step:"0.01",min:"0",value:s[7],onInput:o=>w(l,o),onKeydown:f(o=>g(o,l,7),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:o=>b(`gst-amount-${l}`,o)},null,40,Ee)]),a("td",qe,v(G(l)),1),a("td",null,[a("span",{class:"cursor-pointer badge rounded-pill text-bg-primary me-2",onClick:o=>D(l)},[...t[2]||(t[2]=[a("i",{class:"fa fa-plus","aria-hidden":"true"},null,-1)])],8,Ae),n.value.length>1?(r(),d("span",{key:0,class:"cursor-pointer badge rounded-pill text-bg-danger",onClick:o=>te(l)},[...t[3]||(t[3]=[a("i",{class:"fa fa-minus","aria-hidden":"true"},null,-1)])],8,Se)):k("",!0)])]))),128)),a("tr",Pe,[t[4]||(t[4]=a("td",{colspan:"5",class:"text-end font-bold"},"TOTALS:",-1)),a("td",De,v(R()),1),t[5]||(t[5]=a("td",null,null,-1)),a("td",Ge,v(H()),1),t[6]||(t[6]=a("td",null,null,-1)),a("td",Re,v(U()),1),a("td",He,v(B()),1),t[7]||(t[7]=a("td",null,null,-1))])])])]),a("div",Ue,[a("button",{class:"btn btn-info text-white text-bold",onClick:le,disabled:C(i).processing},[C(i).processing?(r(),d("span",Oe,"Updating...")):(r(),d("span",Me,"Update Invoice"))],8,Be),a("button",{class:"btn btn-secondary",onClick:oe}," Cancel ")]),Object.keys(C(i).errors).length>0?(r(),d("div",ze,[t[9]||(t[9]=a("h6",null,"Please fix the following errors:",-1)),a("ul",je,[(r(!0),d(T,null,q(C(i).errors,(s,l)=>(r(),d("li",{key:l},v(s),1))),128))])])):k("",!0)])):k("",!0)]),_:1})],64))}},Je=fe(Le,[["__scopeId","data-v-c6fb13b2"]]);export{Je as default};
