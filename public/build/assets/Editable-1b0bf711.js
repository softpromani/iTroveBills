import{T as ct,p as g,o as m,c as f,b as o,a as it,w as rt,q as dt,F as T,x as Q,t as r,D as i,e as pt,n as vt,d as mt,f as E,y as ft,E as b}from"./app-08b61d9d.js";import{_ as ht}from"./_plugin-vue_export-helper-c27b6911.js";const gt={key:0},bt={class:"rounded-lg shadow table-responsive"},yt={class:"table table-bordered"},_t=["value","onInput","onKeydown"],Ft={class:"position-relative"},$t=["value","onInput","onFocus","onBlur","onKeydown"],Kt={key:0,class:"dropdown-menu show position-absolute w-100",style:{top:"100%","z-index":"1000","max-height":"200px","overflow-y":"auto"}},Tt=["onMousedown"],Et=["value","onInput","onKeydown"],Nt=["value","onInput","onKeydown"],Vt=["value","onInput","onKeydown"],Ct=["value","onInput","onKeydown"],kt={class:"text-end"},Bt=["value","onInput","onKeydown"],St=["value","onInput","onKeydown"],At={class:"text-end"},Dt=["onClick"],Gt=["onClick"],Pt={class:"table-info"},qt={class:"font-bold text-end"},Rt={class:"font-bold text-end"},Ht={class:"font-bold text-end"},Ot={class:"font-bold text-end"},zt={__name:"Editable",setup(Mt){const U=ct({}),n=g([["","",0,"",0,0,0,0]]),N=g([]),_=g(!0),c=g({}),d=g({}),F=g(null),u=g({}),h=(t,l)=>{l&&(u.value[t]=l)},J=()=>{_.value=!_.value},p=(t,l,s)=>{t.shiftKey?(t.preventDefault(),Y(l,s)):(t.preventDefault(),X(l,s))},X=(t,l)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(l<s.length-1){const e=`${s[l+1]}-${t}`;b(()=>{u.value[e]&&u.value[e].focus()})}else if(t<n.value.length-1){const e=`${s[0]}-${t+1}`;b(()=>{u.value[e]&&u.value[e].focus()})}else k(t),b(()=>{const e=t+1,a=`${s[0]}-${e}`;u.value[a]&&u.value[a].focus()})},Y=(t,l)=>{const s=["description","hsn","quantity","unit","weight","rate","gst-percentage","gst-amount"];if(l>0){const e=`${s[l-1]}-${t}`;b(()=>{u.value[e]&&u.value[e].focus()})}else if(t>0){const e=`${s[s.length-1]}-${t-1}`;b(()=>{u.value[e]&&u.value[e].focus()})}},v=(t,l,s)=>{let e=s.target.value;if([2,4,5,6,7].includes(l)){const a=parseFloat(e);e=isNaN(a)?0:a}n.value[t][l]=e,[2,5].includes(l)&&at(t)},Z=async(t,l)=>{const s=l.target.value;if(v(t,1,l),F.value&&clearTimeout(F.value),!s.trim()){d.value[t]=!1,c.value[t]=[];return}F.value=setTimeout(async()=>{try{const e=await ft.get("/hsn/search",{params:{q:s}});c.value[t]=e.data,d.value[t]=!0}catch(e){console.error("Error searching HSN codes:",e),c.value[t]=[]}},300)},x=t=>{setTimeout(()=>{d.value[t]=!1},200)},w=t=>{d.value[t]=!1},I=t=>{c.value[t]&&c.value[t].length>0&&V(t,c.value[t][0])},V=(t,l)=>{n.value[t][1]=l.code,d.value[t]=!1,c.value[t]=[],b(()=>{const s=`quantity-${t}`;u.value[s]&&u.value[s].focus()})},tt=(t,l)=>{v(t,6,l),C(t)},et=(t,l)=>{v(t,7,l),lt(t)},C=t=>{const l=parseFloat(n.value[t][6])||0,e=(parseFloat(y(t))||0)*l/100;n.value[t][7]=parseFloat(e.toFixed(2))},lt=t=>{const l=parseFloat(n.value[t][7])||0,s=parseFloat(y(t))||0;if(s>0){const e=l/s*100;n.value[t][6]=parseFloat(e.toFixed(2))}},at=t=>{(parseFloat(n.value[t][6])||0)>0&&C(t)},k=t=>{const l=["","",0,"",0,0,0,0];n.value.splice(t+1,0,l),b(()=>{})},ot=t=>{n.value.length>1&&(n.value.splice(t,1),Object.keys(u.value).forEach(l=>{l.includes(`-${t}`)&&delete u.value[l]}),delete c.value[t],delete d.value[t])},y=t=>{const l=parseFloat(n.value[t][2])||0,s=parseFloat(n.value[t][5])||0;return(l*s).toFixed(2)},B=t=>{const l=parseFloat(y(t))||0,s=parseFloat(n.value[t][7])||0;return(l+s).toFixed(2)},S=()=>n.value.reduce((t,l)=>t+(parseFloat(l[4])||0),0).toFixed(2),A=()=>n.value.reduce((t,l,s)=>t+parseFloat(y(s)),0).toFixed(2),D=()=>n.value.reduce((t,l)=>t+(parseFloat(l[7])||0),0).toFixed(2),G=()=>n.value.reduce((t,l,s)=>t+parseFloat(B(s)),0).toFixed(2),st=()=>{var q,R,H,O,z,M,W,L,j;const t=((q=document.getElementById("invoice_no"))==null?void 0:q.value)||"",l=((R=document.getElementById("customer"))==null?void 0:R.value)||"",s=((H=document.getElementById("company"))==null?void 0:H.value)||"",e=((O=document.getElementById("vehical_no"))==null?void 0:O.value)||"",a=((z=document.getElementById("customer_name"))==null?void 0:z.value)||"",$=((M=document.getElementById("mobile"))==null?void 0:M.value)||"",P=((W=document.getElementById("address"))==null?void 0:W.value)||"",nt=((L=document.getElementById("email"))==null?void 0:L.value)||"",ut=((j=document.getElementById("gst"))==null?void 0:j.value)||"";if(!t||!s||!e){alert("Please fill in all required fields (Invoice No, Company, Vehicle No)");return}if(!n.value.some(K=>K[0].trim()!==""||K[1].trim()!==""||parseFloat(K[2])>0)){alert("Please add at least one item to the invoice");return}N.value[0]={invoice:t,customer:l,company:s,vehical_no:e,totalWeight:S(),totalTaxableValue:A(),totalGstAmount:D(),grandTotal:G(),customer_name:a,mobile:$,address:P,email:nt,gst:ut},U.post(route("gst.customer.store.bill",{invoicedata:n.value,invoicedetails:N.value}),{preserveScroll:!0})};return(t,l)=>(m(),f(T,null,[o("div",{class:"mt-5 bg-purple-700 rounded-md position-relative py-2 px-3"},[l[1]||(l[1]=o("h2",{class:"text-sm font-medium text-center text-white font-weight-bolder mb-0"}," INVOICE ",-1)),o("span",{class:"text-white cursor-pointer top-2 right-3 position-absolute",onClick:J},[...l[0]||(l[0]=[o("i",{class:"fa-solid fa-bullseye fa-lg"},null,-1)])])]),it(dt,{name:"slide-fade"},{default:rt(()=>[_.value?(m(),f("div",gt,[o("div",bt,[o("table",yt,[l[8]||(l[8]=o("thead",{class:"table-dark"},[o("tr",null,[o("th",null,"S.NO."),o("th",null,"Description of Product"),o("th",null,"HSN Code"),o("th",null,"Quantity"),o("th",null,"Unit"),o("th",null,"Weight"),o("th",null,"Rate"),o("th",null,"Taxable Value"),o("th",null,"GST %"),o("th",null,"GST Amount"),o("th",null,"Subtotal"),o("th",null,"Action")])],-1)),o("tbody",null,[(m(!0),f(T,null,Q(n.value,(s,e)=>(m(),f("tr",{key:`row-${e}`},[o("td",null,r(e+1),1),o("td",null,[o("input",{type:"text",value:s[0],onInput:a=>v(e,0,a),onKeydown:i(a=>p(a,e,0),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter description"},null,40,_t)]),o("td",Ft,[o("input",{type:"text",value:s[1],onInput:a=>Z(e,a),onFocus:a=>d.value[e]=!0,onBlur:a=>x(e),onKeydown:[i(a=>p(a,e,1),["tab"]),i(a=>I(e),["enter"]),i(a=>w(e),["escape"])],class:"form-control border-0 p-1",placeholder:"Enter HSN Code",autocomplete:"off",ref_for:!0,ref:a=>h(`hsn-${e}`,a)},null,40,$t),d.value[e]&&c.value[e]&&c.value[e].length>0?(m(),f("div",Kt,[(m(!0),f(T,null,Q(c.value[e],(a,$)=>(m(),f("div",{key:a.code,onMousedown:pt(P=>V(e,a),["prevent"]),class:vt(["dropdown-item cursor-pointer hover-item",{active:$===0}]),style:{"font-size":"12px",padding:"8px 12px"}},[o("strong",null,r(a.code),1),mt(" - "+r(a.description),1)],42,Tt))),128))])):E("",!0)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[2],onInput:a=>v(e,2,a),onKeydown:i(a=>p(a,e,2),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`quantity-${e}`,a)},null,40,Et)]),o("td",null,[o("input",{type:"text",value:s[3],onInput:a=>v(e,3,a),onKeydown:i(a=>p(a,e,3),["tab"]),class:"form-control border-0 p-1",placeholder:"Enter unit",ref_for:!0,ref:a=>h(`unit-${e}`,a)},null,40,Nt)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[4],onInput:a=>v(e,4,a),onKeydown:i(a=>p(a,e,4),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`weight-${e}`,a)},null,40,Vt)]),o("td",null,[o("input",{type:"number",step:"0.01",value:s[5],onInput:a=>v(e,5,a),onKeydown:i(a=>p(a,e,5),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`rate-${e}`,a)},null,40,Ct)]),o("td",kt,r(y(e)),1),o("td",null,[o("input",{type:"number",step:"0.01",min:"0",max:"100",value:s[6],onInput:a=>tt(e,a),onKeydown:i(a=>p(a,e,6),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`gst-percentage-${e}`,a)},null,40,Bt)]),o("td",null,[o("input",{type:"number",step:"0.01",min:"0",value:s[7],onInput:a=>et(e,a),onKeydown:i(a=>p(a,e,7),["tab"]),class:"form-control border-0 p-1",placeholder:"0",ref_for:!0,ref:a=>h(`gst-amount-${e}`,a)},null,40,St)]),o("td",At,r(B(e)),1),o("td",null,[o("span",{class:"cursor-pointer badge rounded-pill text-bg-primary me-2",onClick:a=>k(e)},[...l[2]||(l[2]=[o("i",{class:"fa fa-plus","aria-hidden":"true"},null,-1)])],8,Dt),n.value.length>1?(m(),f("span",{key:0,class:"cursor-pointer badge rounded-pill text-bg-danger",onClick:a=>ot(e)},[...l[3]||(l[3]=[o("i",{class:"fa fa-minus","aria-hidden":"true"},null,-1)])],8,Gt)):E("",!0)])]))),128)),o("tr",Pt,[l[4]||(l[4]=o("td",{colspan:"5",class:"text-end font-bold"},"TOTALS:",-1)),o("td",qt,r(S()),1),l[5]||(l[5]=o("td",null,null,-1)),o("td",Rt,r(A()),1),l[6]||(l[6]=o("td",null,null,-1)),o("td",Ht,r(D()),1),o("td",Ot,r(G()),1),l[7]||(l[7]=o("td",null,null,-1))])])])]),o("button",{class:"text-white btn btn-info text-bold mt-3",onClick:st}," Submit ")])):E("",!0)]),_:1})],64))}},Qt=ht(zt,[["__scopeId","data-v-40ad9659"]]);export{Qt as default};
